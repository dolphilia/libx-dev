---
import { getLegacyProjectConfig, initializeConfig } from '../../config/project.config.new';
import type { LocaleKey } from '@docs/i18n/locales';
import { generateRedirectUrl } from '../../utils/dynamic-navigation';

export async function getStaticPaths() {
  // getStaticPaths内で設定を初期化
  await initializeConfig();
  const projectConfig = await getLegacyProjectConfig();
  
  return projectConfig.supportedLangs.map(lang => ({
    params: { lang }
  }));
}

const { lang: langParam } = Astro.params;
const lang = (langParam || 'en') as LocaleKey;

// 設定を再度初期化（プロパティセクション）
await initializeConfig();
const projectConfig = await getLegacyProjectConfig();
const baseUrl = projectConfig.baseUrl;

// 動的にリダイレクト先を決定
const redirectUrl = await generateRedirectUrl(lang, baseUrl);

// リダイレクトを実行
return Astro.redirect(redirectUrl);
---

<!-- このページは動的リダイレクトのため、HTMLコンテンツは不要 -->
