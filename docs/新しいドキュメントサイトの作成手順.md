# 新しいドキュメントサイトの作成手順

このガイドでは、既存の`project-template`をベースに新しいドキュメントサイトを作成する方法を説明します。

## 前提条件

- Node.js および pnpm がインストールされていること
- このモノレポのルートディレクトリで作業していること

## 手順

### 1. プロジェクトディレクトリの作成

既存のプロジェクトをコピーして新しいプロジェクトを作成します。

```bash
# apps/project-template を新しいプロジェクト名でコピー
cp -r apps/project-template apps/新しいプロジェクト名
```

### 2. package.json の更新

新しいプロジェクトの `apps/新しいプロジェクト名/package.json` を編集します。

```json
{
  "name": "apps-新しいプロジェクト名",
  // その他の設定は同じ
}
```

**重要**: プロジェクト名は `apps-` プレフィックスが必要です。これはpnpmワークスペースとビルドスクリプトが正しく動作するために必要です。

### 3. Astro設定ファイルの更新

`apps/新しいプロジェクト名/astro.config.mjs` を編集します。

```javascript
export default defineConfig({
  // ベースパスを新しいプロジェクト名に変更
  base: '/docs/新しいプロジェクト名',
  
  integrations: [
    mdx({
      remarkPlugins: [
        // リンク変換プラグインのbaseUrlも更新
        [remarkLinkTransformer, { baseUrl: '/docs/新しいプロジェクト名' }]
      ],
      // その他の設定
    }),
  ],
  // その他の設定は同じ
});
```

### 4. プロジェクト設定ファイルの更新

`apps/新しいプロジェクト名/src/config/project.config.json` を編集します。

```json
{
  "basic": {
    "baseUrl": "/docs/新しいプロジェクト名",
    "supportedLangs": ["en", "ja"],
    "defaultLang": "en"
  },
  "translations": {
    "en": {
      "displayName": "新しいプロジェクトの英語名",
      "displayDescription": "英語での説明文",
      "categories": {
        // カテゴリ定義（必要に応じて変更）
      }
    },
    "ja": {
      "displayName": "新しいプロジェクトの日本語名",
      "displayDescription": "日本語での説明文",
      "categories": {
        // カテゴリ定義（必要に応じて変更）
      }
    }
  },
  "versioning": {
    // バージョン設定（必要に応じて変更）
  }
}
```

### 5. トップページの設定更新

`apps/top-page/src/config/projects.config.json` に新しいプロジェクトのデコレーション情報を追加します。

```json
{
  // 既存の設定...
  "projectDecorations": {
    "project-template": {
      // 既存のproject-template設定
    },
    "新しいプロジェクト名": {
      "icon": "適切なアイコン名",
      "tags": ["タグ1", "タグ2"],
      "isNew": true
    }
  }
}
```

**利用可能なアイコン**: `file-text`, `settings`, `book`, `code`, `database`, `globe` など

### 6. 依存関係のインストール

新しいプロジェクトで依存関係をインストールします。

```bash
cd apps/新しいプロジェクト名
rm -rf node_modules
pnpm install
```

### 7. 動作確認

#### 開発サーバーのテスト

```bash
# プロジェクト個別での開発サーバー起動
pnpm --filter=apps-新しいプロジェクト名 dev

# または、プロジェクトディレクトリから
cd apps/新しいプロジェクト名
pnpm dev
```

アクセス先: `http://localhost:4321/docs/新しいプロジェクト名`

#### ビルドテスト

```bash
# 個別プロジェクトのビルド
pnpm --filter=apps-新しいプロジェクト名 build

# 統合ビルド（全プロジェクト）
pnpm build
```

## 注意事項とトラブルシューティング

### 注意事項

1. **プロジェクト名の命名規則**
   - package.jsonでは `apps-プロジェクト名` 形式
   - ディレクトリ名は `プロジェクト名` のみ
   - baseUrlは `/docs/プロジェクト名` 形式

2. **統合ビルドシステム**
   - `scripts/build-integrated.js` は `apps/` ディレクトリから自動でプロジェクトを検出
   - 追加の設定変更は不要（top-page以外のプロジェクトは自動で `/docs/プロジェクト名/` にマッピング）

3. **依存関係**
   - 新しいプロジェクトでは必ず `pnpm install` を実行
   - 共有パッケージ（`@docs/*`）は自動で正しいバージョンがリンクされる

### トラブルシューティング

#### 開発サーバーが起動しない場合

1. `node_modules` を削除して再インストール

   ```bash
   cd apps/新しいプロジェクト名
   rm -rf node_modules
   pnpm install
   ```

2. pnpmワークスペース経由で起動

   ```bash
   pnpm --filter=apps-新しいプロジェクト名 dev
   ```

#### ビルドエラーが発生する場合

1. 設定ファイルの構文チェック（JSON形式）
2. baseUrlの一貫性確認（astro.config.mjs と project.config.json）
3. プロジェクト名の一貫性確認

#### リンク変換が正しく動作しない場合

1. `astro.config.mjs` の `remarkLinkTransformer` の `baseUrl` を確認
2. `project.config.json` の `baseUrl` との一致を確認

## 検証済みの設定値

以下の設定値で正常動作することを確認済み：

- **test-project**
  - package.json: `"name": "apps-test-project"`
  - astro.config.mjs: `base: '/docs/test-project'`
  - project.config.json: `"baseUrl": "/docs/test-project"`
  - 開発サーバー: `http://localhost:4321/docs/test-project`
  - ビルド: 成功
  - 統合ビルド: 成功

## 次のステップ

このマニュアル手順を元に、自動化スクリプトを作成することが可能です。スクリプト作成時は：

1. 引数の検証（プロジェクト名、表示名、説明）
2. 既存プロジェクトの重複チェック
3. ファイルコピーと設定置換の自動化
4. 依存関係インストールの自動実行
5. 動作確認の自動テスト

を含めることを推奨します。